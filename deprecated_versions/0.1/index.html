<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>On the storage of arbitrarily aggregated data arrays (v0.1)</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
  <li><a href="#">CFA</a>
      <select onchange="location = this.options[this.selectedIndex].value;">
  <option value="../0.4/index.html">0.4
  <option value="../0.3/index.html">0.3
  <option value="../0.2.2/index.html">0.2.2
  <option value="../0.2.1/index.html">0.2.1
  <option value="../0.2/index.html">0.2
  <option value="../0.1/index.html"selected>0.1
  </select>
  </li>

  
        <li><a href="#"></a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="on-the-storage-of-arbitrarily-aggregated-data-arrays-version">
<h1>On the storage of arbitrarily aggregated data arrays (v0.1)<a class="headerlink" href="#on-the-storage-of-arbitrarily-aggregated-data-arrays-version" title="Permalink to this headline">¶</a></h1>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This document describes a framework for storing arbitrarily aggregated
data arrays within memory and proposes a convention for efficiently
storing them in a file.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The proposed <a class="reference external" href="https://cf-pcmdi.llnl.gov/trac/ticket/78">CF aggregation rules</a> allow for the aggregation
of CF fields across multiple dimensions. These rules are based solely
on the fields&#8217; metadata, therefore allowing aggregation to be reliably
automated. This raises the possibility of large amounts of
aggregations being created and therefore storing these collections is
clearly desirable.</p>
<p>This document describes how the data arrays of such aggregations could
be stored in the memory of an application and proposes a convention &#8211;
the NCA (netCDF aggregate) convention &#8211; for their efficient file
storage.</p>
<p>The key element of the NCA files is that they are CF-compliant netCDF
files, albeit ones which require extra processing to realise their
aggregated data arrays.</p>
<p>This style of aggregation marks a considerable advance from <a class="reference external" href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html">NetCDF
Markup Language (NcML) aggregation</a>,
which has long-standing use in the community but is relatively
limited.</p>
</div>
<div class="section" id="a-conceptual-framework-for-the-in-memory-storage-of-aggregated-arrays">
<h2>A conceptual framework for the in-memory storage of aggregated arrays<a class="headerlink" href="#a-conceptual-framework-for-the-in-memory-storage-of-aggregated-arrays" title="Permalink to this headline">¶</a></h2>
<p>An <strong>aggregated data array</strong> (or <strong>master array</strong>) is one which is
<strong>partitioned</strong> such that each <strong>partition</strong> is replaced by a
reference to an independent, non-aggregated array which contains the
data, called a <strong>sub-array</strong>.</p>
<p>Aggregated data arrays arise naturally from the <a class="reference external" href="https://cf-pcmdi.llnl.gov/trac/ticket/78">aggregation process</a>, but may be generated by
other mechanisms (such the <a class="reference external" href="http://cfpython.bitbucket.org/docs/cf-0.9.6/build/lama.html">Large Amounts of Massive Arrays (LAMA)</a>
functionality of <a class="reference external" href="http://cfpython.bitbucket.org">cf-python</a>).</p>
<p>The sub-array referred to by each <strong>partition</strong> exists either as an
actual array in memory or as another reference to an array contained
within a file.</p>
<p>The master array may be partitioned along any, arbitrary subset of its
dimensions. The choice of partition positions does not affect the
master array. The only constraint on partition positions is that the
matrix of partitions (the <strong>partition matrix</strong>) must be be
hyperrectangular, i.e. it must not ragged along any of the partition
dimensions.</p>
<p>To meet the requirement of a hyperrectangular partition matrix, it may
be necessary to add <strong>virtual partitions</strong> to the master array. This
will be the case if the master array&#8217;s sub-array edges are not all
aligned. Virtual partitions allow the master array to view a sub-array
as two or more independent sub-arrays without turning the sub-array
itself into an aggregated data array. Each virtual partition is a
reference to a <strong>part</strong> of a sub-array. Virtual partitions are
positioned so as to ensure that all partition edges are aligned and
therefore that the partition matrix is hyperrectangular.</p>
<p>The master array makes no distinction between partitions and virtual
partitions so, henceforth, both are referred as partitions, and a
<strong>partition&#8217;s data array</strong> refers to the part of an array to which it
refers. The partition&#8217;s sub-array is always the entire array of which
the partition&#8217;s data array is a part.</p>
<hr class="docutils" />
<p><strong>Example 1: Partitions of a 2 dimensional master array</strong></p>
<p>The 2-dimensional 8 x 7 master array in <em>figure 1a</em> is composed from
11 sub-arrays. These sub-arrays do not form a rectangular matrix (not
all of their edges are aligned), so virtual partitions are created
resulting in 24 partitions arranged in a hyperrectangular 4 x 6 matrix
(<em>figure 1b</em>).</p>
<div class="figure">
<img alt="_images/partitions1.png" src="_images/partitions1.png" />
<p class="caption"><strong>Figure 1a</strong>. The 11 sub-arrays of the master array.</p>
</div>
<div class="figure">
<img alt="_images/partitions2.png" src="_images/partitions2.png" />
<p class="caption"><strong>Figure 1b</strong>. Each block of colour represents one of the 11
sub-arrays and each of the master array&#8217;s partitions is labelled P<sub>yx</sub></p>
</div>
<hr class="docutils" />
<div class="section" id="accounting-for-arbitrary-sub-array-properties">
<h3>Accounting for arbitrary sub-array properties<a class="headerlink" href="#accounting-for-arbitrary-sub-array-properties" title="Permalink to this headline">¶</a></h3>
<p>There are aspects of a sub-array (such as the order of its dimensions) which
are arbitrary and are therefore do not affect the master array. Relative to
the master array, a sub-array may have:</p>
<ul class="simple">
<li>Differently ordered dimensions</li>
<li>Missing or extra size 1 dimensions</li>
<li>Dimensions which run in different senses</li>
<li>Different, but equivalent, units</li>
</ul>
<p>When a partition&#8217;s data array is required by the master array, it needs to
be <strong>conformed</strong> by doing any or none of:</p>
<ul class="simple">
<li>Reordering its dimensions to the same order as the master array</li>
<li>Removing size 1 dimensions which don&#8217;t exist in the master array</li>
<li>Adding size 1 dimensions which exist in the master array but not in the sub-array</li>
<li>Reversing dimensions which run in the opposite direction to the master array</li>
<li>Converting the data values to have the same units as the master array</li>
</ul>
</div>
</div>
<div class="section" id="parameters-required-for-specifying-an-aggregated-data-array">
<h2>Parameters required for specifying an aggregated data array<a class="headerlink" href="#parameters-required-for-specifying-an-aggregated-data-array" title="Permalink to this headline">¶</a></h2>
<p>It follows that an aggregated data array and its partitions may be
completely specified by a small number of parameters. The master array
comprises:</p>
<blockquote>
<div><dl class="docutils">
<dt><strong>dtype</strong></dt>
<dd>The data type of the master array&#8217;s dimensions</dd>
<dt><strong>units</strong></dt>
<dd>The units of the master array.</dd>
<dt><strong>calendar</strong> (<em>optional</em>)</dt>
<dd>The calendar of the master array.</dd>
<dt><strong>dimensions</strong></dt>
<dd>An ordered list of the master array&#8217;s dimensions.</dd>
<dt><strong>shape</strong></dt>
<dd>An ordered list of the master array&#8217;s dimension sizes.</dd>
<dt><strong>directions</strong></dt>
<dd>An ordered list of the master array&#8217;s dimension directions.</dd>
<dt><strong>pdimensions</strong></dt>
<dd>An ordered list of the dimensions along which the master array
is partitioned.</dd>
<dt><strong>pshape</strong></dt>
<dd>An ordered list containing the number of partitions along each
partitioned dimension of the master array. The sizes correspond
to the <em>pdimensions</em> list.</dd>
<dt><strong>Partitions</strong></dt>
<dd>A matrix of the master array&#8217;s partitions.</dd>
</dl>
</div></blockquote>
<p>Each partition comprises:</p>
<blockquote>
<div><dl class="docutils">
<dt><strong>location</strong></dt>
<dd>An ordered list of the ranges of indices for each dimension of
the master array which describe the section of the master array
spanned by this partition.</dd>
<dt><strong>dimensions</strong></dt>
<dd>An ordered list of the partition&#8217;s data array&#8217;s dimensions.</dd>
<dt><strong>directions</strong></dt>
<dd>An ordered list of the partition&#8217;s data array&#8217;s dimension
directions.</dd>
<dt><strong>units</strong></dt>
<dd>A string containing the units of the partition&#8217;s data array.</dd>
<dt><strong>calendar</strong> (<em>optional</em>)</dt>
<dd>A string containing the calendar of the partition&#8217;s data array.</dd>
<dt><strong>part</strong></dt>
<dd>An ordered list of indices for each dimension of the partition&#8217;s
sub-array which describes the part of the sub-array which
applies to this partition.</dd>
<dt><strong>data</strong></dt>
<dd>A reference to the partition&#8217;s sub-array.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="the-nca-convention">
<h2>The NCA convention<a class="headerlink" href="#the-nca-convention" title="Permalink to this headline">¶</a></h2>
<p><strong>A proposal for the efficient netCDF file storage of aggregated data
arrays</strong></p>
<div class="section" id="storing-the-aggregated-data-array-parameters-in-a-string">
<h3>Storing the aggregated data array parameters in a string<a class="headerlink" href="#storing-the-aggregated-data-array-parameters-in-a-string" title="Permalink to this headline">¶</a></h3>
<p>With the exception of a partition&#8217;s <em>data</em> parameter, all of the
values of the parameters which describe an aggregated data array are
of one the following basic types:</p>
<ul class="simple">
<li>string</li>
<li>number</li>
<li>boolean</li>
<li>list</li>
<li>associative array</li>
</ul>
<p>The partition&#8217;s <em>data</em> parameter is more complicated, as it may be an
actual array in memory or some type of reference to a file. In the
latter case, the reference may be encapsulated by a collection of
these basic types (for example, if the reference is to a netCDF
variable, then all that is required are its filename (string), the
variable name (string) and its shape (list of numbers)). In the former
case, note that when writing an aggregated array to a netCDF file, the
in-memory array may be written to a variable in the same netCDF file
as the aggregated data array and therefore all that is need are the
filename, the variable name and its shape (see <em>example 3</em>).</p>
<p>Therefore, when the aggregated data array is to be stored in a netCDF
file, the parameters which completely it may all be cast as the
aforementioned basic types end therefore may be easily encoded in a
JSON (JavaScript Object Notation) string for simple inclusion in the
file.</p>
<p>JSON is a lightweight data-interchange format which is easy for humans
to read and write and easy for machines to parse and generate. There
are JSON encoders and decoders for every reasonable language. See the
<a class="reference external" href="http://en.wikipedia.org/wiki/JSON">JSON Wikipedia article</a> for
examples.</p>
</div>
<div class="section" id="creating-a-netcdf-variable-for-the-aggregated-data-array">
<h3>Creating a netCDF variable for the aggregated data array<a class="headerlink" href="#creating-a-netcdf-variable-for-the-aggregated-data-array" title="Permalink to this headline">¶</a></h3>
<p>A multidimensional aggregated data array may be stored in a <strong>scalar
netCDF variable</strong>, one of whose attributes is the JSON encoded string
of the aggregated data array parameters. When read, this scalar array
variable may then be converted to a multidimensional array variable
after the parameters have been decoded.</p>
<p>Such a variable is called an <strong>NCA variable</strong> (netCDF aggregate
variable) and a file storing NCA variables is called an <strong>NCA file</strong>
(netCDF aggregate file) and should include &#8216;CF&#8217; and &#8216;NCA&#8217; in its
global <tt class="docutils literal"><span class="pre">conventions</span></tt> attribute.</p>
<div class="section" id="advantages">
<h4>Advantages<a class="headerlink" href="#advantages" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>NCA files are CF compliant.</li>
<li>Variables within an NCA file may be a mixture of normal,
multidimensional array variables and NCA variables.</li>
<li>Much, if not all, of the discovery metadata in an NCA is independent
of the aggregated data array convention and so is accessible to all
netCDF readers.</li>
<li>Changes to the elements of the aggregated data array may be stored.</li>
<li>An NCA variable may have any attributes attached to it.</li>
<li>NCA encoded parameters may be succinct, as there are clear rules on
taking default values for partitions.</li>
</ul>
</div>
<div class="section" id="disadvantages">
<h4>Disadvantages<a class="headerlink" href="#disadvantages" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Software which creates and reads NCA files in their entirety needs
to be able to cope with aggregated data arrays. However, <a class="reference external" href="http://cfpython.bitbucket.org">cf-python</a> can do this.</li>
</ul>
</div>
<div class="section" id="comparison-with-ncml-aggregation">
<h4>Comparison with NcML aggregation<a class="headerlink" href="#comparison-with-ncml-aggregation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.unidata.ucar.edu/software/netcdf/ncml/v2.2/Aggregation.html">NetCDF Markup Language (NcML) aggregation</a>
doesn&#8217;t allow:</p>
<ul class="simple">
<li>Multidimensional aggregation</li>
<li>Metadata-based aggregation</li>
<li>Alterations to the data or metadata</li>
</ul>
</div>
<div class="section" id="recommended-usage">
<h4>Recommended usage<a class="headerlink" href="#recommended-usage" title="Permalink to this headline">¶</a></h4>
<p>It is recommended, though not necessary to write the following types
of variable as normal (non-NCA) netCDF variables:</p>
<ul class="simple">
<li>1-dimensional coordinates and their bounds (to facilitate
discovery).</li>
<li>Aggregated data arrays with only one partition whose data array is
in-memory (to avoid unnecessary obfuscation).</li>
</ul>
<hr class="docutils" />
<p><strong>Example 2: A simple NCA file</strong>:</p>
<div class="highlight-python"><pre>netcdf temperature.nca {
dimensions:
       time = 48 ;
       lat = 64 ;
       lon = 128 ;
variable:

    double time(time) ;
            time:long_name = "time" ;
            time:units = "days since 0000-1-1" ;
    double lat(lat) ;
            lat:units = "degrees_north" ;
            lat:standard_name = "latitude" ;
    double lon(lon) ;
            lon:units = "degrees_east" ;
            lon:standard_name = "longitude" ;
    float tas ;
            tas:standard_name = "air_temperature" ;
            tas:units = "K" ;
            tas:nca_dimensions = "time lat lon" ;
            tas:nca_array = "{directions': {'lat': false,
                                            'time': true,
                                            'lon': true
                                           },
                              'pshape': [2],
                              'pdimensions': ['time'],
                              'Partitions': [{'index': [0],
                                              'data': {'file': '/home/david/test1.nc',
                                                       'shape': [12, 64, 128],
                                                       'ncvar': 'tas'
                                                      },
                                              'location': [[0, 12], [0, 64], [0, 128]],
                                              'format': 'netCDF'
                                             },
                                             {'index': [1],
                                              'data': {'file': '/home/david/test2.nc',
                                                       'shape': [36, 64, 128],
                                                       'ncvar': 'tas2'
                                                      },
                                              'location': [[12, 48], [0, 64], [0, 128]],
                                              'format': 'netCDF'
                                             }
                                            ]
                             }" ;

// global attributes:
               :Conventions = "CF-1.5 NCA" ;
data:

 time = 164569, 164599.5, 164630.5, 164660, 164689.5, 164720, 164750.5,
       // etcetera.

 lat = -87.8638000488281, -85.0965270996094, -82.3129119873047,
       // etcetera.

 lon = 0, 2.8125, 5.625, 8.4375, 11.25, 14.0625, 16.875, 19.6875, 22.5,
       // etcetera.</pre>
</div>
<p>Points to note:</p>
<ul class="simple">
<li>The file specifies two conventions.</li>
<li>The file contains one NCA variable (<tt class="docutils literal"><span class="pre">tas</span></tt>) and three normal
variables (<tt class="docutils literal"><span class="pre">time</span></tt>, <tt class="docutils literal"><span class="pre">lat</span></tt> and <tt class="docutils literal"><span class="pre">lon</span></tt>).</li>
<li>The NCA variable stores the aggregated data array&#8217;s dimensions in a
separate attribute (<tt class="docutils literal"><span class="pre">nca_dimensions</span></tt>) to facilitate
reconstruction of a multidimensional variable without having to decode
the <tt class="docutils literal"><span class="pre">nca_array</span></tt> string.</li>
<li>The <tt class="docutils literal"><span class="pre">nca_array</span></tt> string has been split over many lines for
enhanced readability. Arbitrary new lines are permitted in JSON strings.</li>
<li>The NCA variable defines its data type and units in the normal manner,
so that these parameters of the master array may be omitted from
the <tt class="docutils literal"><span class="pre">nca_array</span></tt> attribute.</li>
<li>The NCA variable may have any CF-netCDF attributes, with no
restrictions.</li>
<li>Parameters of the partitions which are the same as their master array
may be omitted.</li>
</ul>
<hr class="docutils" />
<p><strong>Example 3: storing an aggregated data array with an in-memory partition data array</strong>:</p>
<div class="highlight-python"><pre>netcdf temperature2.nca {
dimensions:
        time = 48 ;
        lat = 64 ;
        lon = 128 ;
        nca12 = 12 ;
        nca64 = 64 ;
        nca128 = 128 ;
variable:
        double time(time) ;
                time:long_name = "time" ;
                time:units = "days since 0000-1-1" ;
        double lat(lat) ;
                lat:units = "degrees_north" ;
                lat:standard_name = "latitude" ;
        double lon(lon) ;
                lon:units = "degrees_east" ;
                lon:standard_name = "longitude" ;
        float tas ;
                tas:standard_name = "air_temperature" ;
                tas:units = "K" ;
                tas:nca_dimensions = "time lat lon" ;
                tas:nca_array = "{directions': {'lat': false,
                                                'time': true,
                                                'lon': true
                                               },
                                  'pshape': [2],
                                  'pdimensions': ['time'],
                                  'Partitions': [{'index': [0],
                                                  'units' : 'K @ 273.15',
                                                  'dimensions': ['lon', 'time', lat'],
                                                  'directions': {'time': false},
                                                  'data': {'shape': [128, 12, 64],
                                                           'ncvar': 'nca_45sdf83745'
                                                          },
                                                  'location': [[0, 12], [0, 64], [0, 128]],
                                                  'format': 'netCDF'
                                                 },
                                                 {'index': [1],
                                                  'data': {'file': '/home/david/test2.nc',
                                                           'shape': [36, 64, 128],
                                                           'ncvar': 'tas2'
                                                          },
                                                  'location': [[12, 48], [0, 64], [0, 128]],
                                                  'format': 'netCDF'
                                                 }
                                                ]
                                 }" ;
        float nca_45sdf83745(nca128, nca12, nca64) ;
                nca_45sdf83745:nca_private = 1 ;


// global attributes:
                :Conventions = "CF-1.5 NCA" ;
data:

 time = 164569, 164599.5, 164630.5, 164660, 164689.5, 164720, 164750.5,
       // etcetera.

 lat = -87.8638000488281, -85.0965270996094, -82.3129119873047,
       // etcetera.

 lon = 0, 2.8125, 5.625, 8.4375, 11.25, 14.0625, 16.875, 19.6875, 22.5,
       // etcetera.

 nca_45sdf83745 = -4.5, 3.5, 23.6, -4.45, 13.5, 13.6,
       // etcetera.</pre>
</div>
<p>Points to note:</p>
<ul class="simple">
<li>The in-memory partition data array has been written to the file with an
automatically generated variable name (<tt class="docutils literal"><span class="pre">nca_45sdf83745</span></tt>), which has an
attribute <tt class="docutils literal"><span class="pre">nca_private</span></tt> to mark it as a private variable according to
the NCA convention.</li>
<li>The in-memory array had different units and dimension order relative to the
master array.</li>
<li>The time dimension of the in-memory array is decreasing, but the other
dimensions run in the same sense as the master array.</li>
<li>The private NCA variable has dimensions which are only used by private NCA
variables.</li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="a-complete-description-of-nca-attributes-describing-the-aggregated-data">
<h3>A complete description of NCA attributes describing the aggregated data<a class="headerlink" href="#a-complete-description-of-nca-attributes-describing-the-aggregated-data" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">nca_private</span></tt></dt>
<dd><p class="first">The integer flagging the containing netCDF variable as containing a
multidimensional array which is referred to by one or more of an
aggregated data array partitions in the NCA file.</p>
<p>For example: <tt class="docutils literal"><span class="pre">1</span></tt></p>
<p class="last">A value of <tt class="docutils literal"><span class="pre">0</span></tt> means the variable is <em>not</em> a private NCA
variable, any other integer means that it is.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">nca_dimensions</span></tt></dt>
<dd><p class="first">An string containing and ordered, space delimited list of the
master array&#8217;s dimensions. The dimension names are all those of
dimensions defined in the NCA file.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">&quot;time</span> <span class="pre">lat</span> <span class="pre">lon&quot;</span></tt></p>
</dd>
<dt><tt class="docutils literal"><span class="pre">nca_array</span></tt></dt>
<dd><p class="first">A JSON encoded string containing parameters required for
constructing the aggregated data array.</p>
<p>Note the <strong>dimensions</strong>, <strong>shape</strong>, <strong>dtype</strong>, <strong>units</strong> and
<strong>calendar</strong> parameters are specified elsewhere (in the
<tt class="docutils literal"><span class="pre">nca_dimensions</span></tt> attribute or by the NCA variable itself) and so
are not required.</p>
<p>The <em>decoded</em> parameter names and types are described here.</p>
<dl class="last docutils">
<dt><strong>directions</strong></dt>
<dd><p class="first">An associative array mapping each dimension of the master array
to a direction. Each direction is described as <tt class="docutils literal"><span class="pre">true</span></tt>
(increasing) or <tt class="docutils literal"><span class="pre">false</span></tt> (decreasing).</p>
<p>For example: <tt class="docutils literal"><span class="pre">{'time',</span> <span class="pre">true,</span> <span class="pre">'lat':</span> <span class="pre">false,</span> <span class="pre">'lon',</span> <span class="pre">true}</span></tt></p>
<p class="last">If the master array is a scalar then a boolean rather than an
associative array is given. (Note that a scalar master array may
have an implied direction (e.g. there are bounds associated with
it or it contains a pressure datum).</p>
</dd>
<dt><strong>pdimensions</strong></dt>
<dd><p class="first">An ordered list of the dimensions along which the master array
is partitioned. Each of these dimensions is one those specified
by the <tt class="docutils literal"><span class="pre">nca_dimensions</span></tt> attribute.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">['lat',</span> <span class="pre">'time']</span></tt></p>
</dd>
<dt><strong>pshape</strong></dt>
<dd><p class="first">An ordered list containing the number of partitions along each
partitioned dimension of the master array. The sizes correspond to
the <em>pdimensions</em> list. This is the shape of the partition
matrix. For</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">[2,</span> <span class="pre">3]</span></tt></p>
</dd>
<dt><strong>Partitions</strong></dt>
<dd><p class="first">A list of each of the master array&#8217;s partitions. The order of
the list is arbitrary since each element contains its (possibly
multidimensional) index in the partition matrix.</p>
<p>Each element of the list specifies a partition with the
following parameters (some of which are optional).</p>
<dl class="last docutils">
<dt><strong>index</strong></dt>
<dd><p class="first">An ordered list of indices (integers greater than or equal to 0)
specifying the position of the partition in the partition matrix. The
indices correspond to the <em>pdimensions</em> list.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">[0,</span> <span class="pre">1]</span></tt></p>
</dd>
<dt><strong>location</strong></dt>
<dd><p class="first">An ordered list of the ranges of indices for each dimension
of the master array which describe the section of the master
array spanned by this partition&#8217;s data array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">[[0,</span> <span class="pre">5],</span> <span class="pre">[3,</span> <span class="pre">6],</span> <span class="pre">[2,</span> <span class="pre">56]]</span></tt></p>
<p class="last">Each doublet refers to a range (start, stop) for the
dimension, e.g. <tt class="docutils literal"><span class="pre">[3,</span> <span class="pre">6]</span></tt> is equivalent to indices 3, 4 and
5.</p>
</dd>
<dt><strong>dimensions</strong> (<em>optional</em>)</dt>
<dd><p class="first">An ordered list of the partition&#8217;s data array&#8217;s dimensions. The
dimension names are all those of dimensions defined in the NCA file.</p>
<p>For example: <tt class="docutils literal"><span class="pre">['lon',</span> <span class="pre">'time',</span> <span class="pre">lat']</span></tt></p>
<p class="last">If missing then it assumed to be equal to dimensions of the master
array. If there are any size 1 dimensions of the partition which are not
spanned by the master array then the partition&#8217;s dimensions must be
specified.</p>
</dd>
<dt><strong>format</strong> (<em>optional</em>)</dt>
<dd><p class="first">A string naming the format of the file containing the partition&#8217;s data
array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">'netCDF'</span></tt></p>
<p class="last">If missing then the format is assumed to that of the NCA
file itself.</p>
</dd>
<dt><strong>directions</strong> (<em>optional</em>)</dt>
<dd><p class="first">An associative array of the partition&#8217;s data array&#8217;s
dimension directions.</p>
<p>For example: <tt class="docutils literal"><span class="pre">{'time',</span> <span class="pre">true,</span> <span class="pre">'lat':</span> <span class="pre">true,</span> <span class="pre">'lon',</span> <span class="pre">false}</span></tt></p>
<p class="last">Any dimension not specified is assumed to be equal to
direction of the corresponding master array dimension. If
there are any size 1 dimensions of the partition which are
not spanned by the master array then their directions must be
specified. Note that such dimensions must be defined in the
netCDF file.</p>
</dd>
<dt><strong>units</strong> (<em>optional</em>)</dt>
<dd><p class="first">A string containing the units of the partition&#8217;s data
array. If missing then it assumed to be equal to units of the
master array.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">'m</span> <span class="pre">s-1'</span></tt></p>
</dd>
<dt><strong>calendar</strong> (<em>optional</em>)</dt>
<dd><p class="first">A string containing the calendar of the partition&#8217;s data
array. If missing then it assumed to be equal to calendar of
the master array.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">'noleap'</span></tt></p>
</dd>
<dt><strong>part</strong> (<em>optional</em>)</dt>
<dd><p class="first">A string describing indices for each dimension of the
partition&#8217;s sub-array (<em>not</em> its data array) which describe
the part of the sub-array which applies to this partition.</p>
<p>For example: <tt class="docutils literal"><span class="pre">'[(2,</span> <span class="pre">6,</span> <span class="pre">1),</span> <span class="pre">[1,3,4,7],</span> <span class="pre">(0,</span> <span class="pre">12,</span> <span class="pre">2)]'</span></tt></p>
<p>Triplets in square brackets a sequence in indices along that
dimension. Triplets in round brackets describe a range
(start, stop, step) for the dimension, e.g. <tt class="docutils literal"><span class="pre">(0,</span> <span class="pre">12,</span> <span class="pre">2)</span></tt> is
equivalent to <tt class="docutils literal"><span class="pre">[0,</span> <span class="pre">2,</span> <span class="pre">4,</span> <span class="pre">6,</span> <span class="pre">8,</span> <span class="pre">10]</span></tt>.</p>
<p class="last">Note that the <em>data</em> attribute describes the whole
sub-array. If missing then it is assumed that the whole of
the sub-array applies to this partition.</p>
</dd>
<dt><strong>data</strong></dt>
<dd><p class="first">Parameters required to extract the partition&#8217;s sub-array
(<em>not</em></p>
<dl class="last docutils">
<dt><strong>shape</strong></dt>
<dd><p class="first">An ordered list of the partition&#8217;s sub-array&#8217;s dimension
sizes.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">[4,</span> <span class="pre">7,</span> <span class="pre">3]</span></tt></p>
</dd>
<dt><strong>file</strong> (<em>optional</em>)</dt>
<dd><p class="first">A string naming the file which holds the partition&#8217;s
sub-array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">'/home/me/temp/pp'</span></tt></p>
<p class="last">If missing then it is assumed to be containing NCA file.</p>
</dd>
<dt><strong>dtype</strong> (<em>optional</em>)</dt>
<dd><p class="first">The data type of the partition&#8217;s sub-array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">'double'</span></tt></p>
<p class="last">If missing then the data type of the master array is
assumed.</p>
</dd>
<dt><strong>ncvar</strong> (<em>netCDF files only</em>)</dt>
<dd>The name of the netCDF variable containing the partition&#8217;s
sub-array.</dd>
<dt><strong>file_offset</strong> (<em>optional</em>)</dt>
<dd><p class="first">The word address of the file where the partition&#8217;s
sub-array starts.</p>
<p class="last">For example: <tt class="docutils literal"><span class="pre">8460364</span></tt></p>
</dd>
<dt><strong>lbpack</strong> (<em>PP files only, optional</em>)</dt>
<dd><p class="first">The PP packing code of the array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">1</span></tt></p>
<p class="last">If missing then assumed to be 0 (unpacked).</p>
</dd>
<dt><strong>scale_factor</strong> (<em>non-netCDF files, optional</em>)</dt>
<dd><p class="first">The scale factor (in the CF sense) of the partition&#8217;s
sub-array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">1000.0</span></tt></p>
<p class="last">For netCDF files, it is assumed that the scale factor will
accounted when reading the file. Otherwise, if missing
then assumed to be 1 (unscaled).</p>
</dd>
<dt><strong>add_offset</strong> (<em>non-netCDF files, optional</em>)</dt>
<dd><p class="first">The additive offset (in the CF sense) of the partition&#8217;s
sub-array.</p>
<p>For example: <tt class="docutils literal"><span class="pre">273.15</span></tt></p>
<p class="last">For netCDF files, it is assumed that the additive factor
will accounted when reading the file. Otherwise, if
missing then assumed to be 0 (no additive offset).</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">On the storage of arbitrarily aggregated data arrays (v0.1)</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#a-conceptual-framework-for-the-in-memory-storage-of-aggregated-arrays">A conceptual framework for the in-memory storage of aggregated arrays</a><ul>
<li><a class="reference internal" href="#accounting-for-arbitrary-sub-array-properties">Accounting for arbitrary sub-array properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parameters-required-for-specifying-an-aggregated-data-array">Parameters required for specifying an aggregated data array</a></li>
<li><a class="reference internal" href="#the-nca-convention">The NCA convention</a><ul>
<li><a class="reference internal" href="#storing-the-aggregated-data-array-parameters-in-a-string">Storing the aggregated data array parameters in a string</a></li>
<li><a class="reference internal" href="#creating-a-netcdf-variable-for-the-aggregated-data-array">Creating a netCDF variable for the aggregated data array</a><ul>
<li><a class="reference internal" href="#advantages">Advantages</a></li>
<li><a class="reference internal" href="#disadvantages">Disadvantages</a></li>
<li><a class="reference internal" href="#comparison-with-ncml-aggregation">Comparison with NcML aggregation</a></li>
<li><a class="reference internal" href="#recommended-usage">Recommended usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-complete-description-of-nca-attributes-describing-the-aggregated-data">A complete description of NCA attributes describing the aggregated data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search term.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
  <li><a href="#">CFA</a>
      <select onchange="location = this.options[this.selectedIndex].value;">
  <option value="../0.4/index.html">0.4
  <option value="../0.3/index.html">0.3
  <option value="../0.2.2/index.html">0.2.2
  <option value="../0.2.1/index.html">0.2.1
  <option value="../0.2/index.html">0.2
  <option value="../0.1/index.html"selected>0.1
  </select>
  </li>

  
        <li><a href="#"></a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, David Hassell.
      Last updated on Feb 27, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>