<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. A conceptual framework for the in-memory storage of aggregated arrays</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="" href="index.html" />
    <link rel="next" title="3. The NCA convention" href="nca.html" />
    <link rel="prev" title="1. Introduction" href="introduction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="nca.html" title="3. The NCA convention"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="1. Introduction"
             accesskey="P">previous</a> |</li>
  <li><a href="index.html">CFA</a>
      <select onchange="location = this.options[this.selectedIndex].value;">
  <option value="../0.4/index.html">0.4
  <option value="../0.3/index.html">0.3
  <option value="../0.2.2/index.html">0.2.2
  <option value="../0.2.1/index.html">0.2.1
  <option value="../0.2/index.html"selected>0.2
  <option value="../0.1/index.html">0.1
  </select>
  </li>

  
        <li><a href="index.html"></a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="a-conceptual-framework-for-the-in-memory-storage-of-aggregated-arrays">
<h1>2. A conceptual framework for the in-memory storage of aggregated arrays<a class="headerlink" href="#a-conceptual-framework-for-the-in-memory-storage-of-aggregated-arrays" title="Permalink to this headline">¶</a></h1>
<p>An <strong>aggregated data array</strong> (or <strong>master array</strong>) is one which is
<strong>partitioned</strong> such that each <strong>partition</strong> is replaced replaced by a
reference to an independent, non-aggregated array which contains the
data, called a <strong>sub-array</strong>.</p>
<p>Aggregated data arrays arise naturally from the <a class="reference external" href="https://cf-pcmdi.llnl.gov/trac/ticket/78">aggregation process</a>, but may be generated by
other mechanisms (such the <a class="reference external" href="http://cfpython.bitbucket.org/docs/0.9.6/build/lama.html">Large Amounts of Massive Arrays (LAMA)</a>
functionality of <a class="reference external" href="http://cfpython.bitbucket.org">cf-python</a>).</p>
<p>The sub-array referred to by each <strong>partition</strong> exists either as an
actual array (in memory, for example) or as another reference to an
array contained within a file.</p>
<p>The master array may be partitioned along any, arbitrary subset of its
dimensions. The choice of partition positions does not affect the
master array. The only constraint on partition positions is that the
matrix of partitions (the <strong>partition matrix</strong>) must be be
hyperrectangular, i.e. it must not ragged along any of the partition
dimensions.</p>
<p>To meet the requirement of a hyperrectangular partition matrix, it may
be necessary to add <strong>virtual partitions</strong> to the master array. This
will be the case if the master array&#8217;s sub-array edges are not all
aligned. Virtual partitions allow the master array to view a sub-array
as two or more, independent sub-arrays without turning the sub-array
itself into an aggregated data array. Each virtual partition is a
reference to a <strong>part</strong> of a sub-array. Virtual partitions are
positioned so as to ensure that all partition edges are aligned and
therefore that the partition matrix is hyperrectangular (see
<a class="reference internal" href="#example1"><em>example 1</em></a>).</p>
<p id="data-array">The master array makes no distinction between partitions and virtual
partitions so, henceforth, both are referred as <strong>partitions</strong>, and a
<strong>partition&#8217;s data array</strong> is defined to be the part of the sub-array
which used by the partition. Note that:</p>
<ul class="simple">
<li>The partition&#8217;s data array is always a subset of the partition&#8217;s
sub-array, and may be equal to it.</li>
<li>The partition&#8217;s data array may be constructed from non-contiguous
sections of the sub-array (see the description of the <a class="reference internal" href="nca_attributes.html#part"><em>part</em></a> attribute for examples).</li>
</ul>
<hr class="docutils" id="example1" />
<p><strong>Example 1: Partitions of a 2-dimensional master array</strong></p>
<p>The 2-dimensional 8 x 7 master array in <strong>figure 1a</strong> is composed from
10 sub-arrays. These sub-arrays do not form a rectangular matrix (not
all of their edges are aligned), so virtual partitions are created
resulting in 24 partitions arranged in a 4 x 6 matrix (<strong>figure 1b</strong>).</p>
<div class="figure">
<img alt="_images/partitions1.png" src="_images/partitions1.png" />
<p class="caption"><strong>Figure 1a</strong>. The 10 sub-arrays of the master array.</p>
</div>
<div class="figure">
<img alt="_images/partitions2.png" src="_images/partitions2.png" />
<p class="caption"><strong>Figure 1b</strong>. Each block of colour represents one of the 10
sub-arrays and each of the master array&#8217;s partitions is labelled P<sub>yx</sub></p>
</div>
<hr class="docutils" />
<div class="section" id="accounting-for-arbitrary-sub-array-properties">
<h2>2.1. Accounting for arbitrary sub-array properties<a class="headerlink" href="#accounting-for-arbitrary-sub-array-properties" title="Permalink to this headline">¶</a></h2>
<p>There are properties of a sub-array which are arbitrary in the sense
that, whilst these properties may differ to their equivalents in the
master array, the sub-array may always be altered to conform with the
master array with no loss of information.</p>
<p>The properties for which a sub-array may differ from its master array
are:</p>
<ul class="simple">
<li>The order of dimensions.</li>
<li>The number of size 1 dimensions.</li>
<li>The sense in which dimensions run.</li>
<li>The units of the data values.</li>
<li>The missing data value.</li>
</ul>
<p>When a partition&#8217;s data array is required by the master array, it
needs to be <strong>conformed</strong> by doing any or none of:</p>
<ul class="simple">
<li>Reordering its dimensions to the same order as the master array.</li>
<li>Removing size 1 dimensions which don&#8217;t exist in the master array.</li>
<li>Adding size 1 dimensions which exist in the master array but not in
the sub-array.</li>
<li>Reversing dimensions which run in the opposite direction to the
master array.</li>
<li>Converting the data values to have the same units as the master
array.</li>
<li><em>Either</em> the missing data value is converted to that of the master
array (accounting for conflicts with non-missing data values) <em>or</em>,
if arrays are stored with ancillary missing data masks (as can be
the case with <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/maskedarray.html">python numpy arrays</a>), the
sub-array&#8217;s missing data value may be ignored.</li>
</ul>
</div>
<div class="section" id="parameters-required-for-specifying-an-aggregated-data-array">
<h2>2.2. Parameters required for specifying an aggregated data array<a class="headerlink" href="#parameters-required-for-specifying-an-aggregated-data-array" title="Permalink to this headline">¶</a></h2>
<p>It follows that an aggregated data array and its partitions may be
completely specified by a small number of parameters.</p>
<p>Note that when a partition has a parameter value equal to the master
array then there is some redundancy which may be exploited when
storing the array by its parameters.</p>
<div class="section" id="master-array-parameters">
<h3>2.2.1. Master array parameters<a class="headerlink" href="#master-array-parameters" title="Permalink to this headline">¶</a></h3>
<p>The master array comprises:</p>
<blockquote>
<div><dl class="docutils" id="frame-dtype">
<dt><strong>dtype</strong></dt>
<dd>The data type of the master array.</dd>
</dl>
<dl class="docutils" id="frame-units">
<dt><strong>units</strong></dt>
<dd>The units of the master array.</dd>
<dt><strong>calendar</strong> (<em>if required by</em> <a class="reference internal" href="#frame-units"><em>units</em></a>)</dt>
<dd>The calendar of the master array.</dd>
</dl>
<dl class="docutils" id="frame-dimensions">
<dt><strong>dimensions</strong></dt>
<dd>An ordered list of the master array&#8217;s dimensions.</dd>
<dt><strong>shape</strong></dt>
<dd>An ordered list of the master array&#8217;s dimension sizes. The sizes
correspond to the <a class="reference internal" href="#frame-dimensions"><em>dimensions</em></a> list.</dd>
<dt><strong>directions</strong></dt>
<dd>An ordered list of the master array&#8217;s dimension directions. The
directions correspond to the <a class="reference internal" href="#frame-dimensions"><em>dimensions</em></a> list.</dd>
</dl>
<dl class="docutils" id="frame-pmdimensions">
<dt><strong>pmdimensions</strong></dt>
<dd>An ordered list of the dimensions along which the master array
is partitioned. Each of these dimensions is one those specified
by the <a class="reference internal" href="#frame-dimensions"><em>dimensions</em></a> parameter.</dd>
</dl>
<dl class="docutils" id="frame-pmshape">
<dt><strong>pmshape</strong></dt>
<dd>An ordered list containing the number of partitions along each
partitioned dimension of the master array. The sizes correspond
to the <a class="reference internal" href="#frame-pmdimensions"><em>pmdimensions</em></a> list.</dd>
</dl>
<dl class="docutils" id="frame-partitions">
<dt><strong>Partitions</strong></dt>
<dd>A matrix of the master array&#8217;s partitions. Each partition is
described by its <a class="reference internal" href="#frame-partitions"><em>partition parameters</em></a>.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="partition-parameters">
<h3>2.2.2. Partition parameters<a class="headerlink" href="#partition-parameters" title="Permalink to this headline">¶</a></h3>
<p>Each partition of the partition matrix comprises:</p>
<blockquote>
<div><dl class="docutils" id="frame-pdimensions">
<dt><strong>pdimensions</strong></dt>
<dd>An ordered list of the partition&#8217;s data array&#8217;s dimensions.</dd>
<dt><strong>pdirections</strong></dt>
<dd>An ordered list of the partition&#8217;s data array&#8217;s dimension
directions. The directions correspond to the <a class="reference internal" href="#frame-pdimensions"><em>pdimensions</em></a> list.</dd>
</dl>
<dl class="docutils" id="frame-punits">
<dt><strong>punits</strong></dt>
<dd>The units of the partition&#8217;s data array.</dd>
<dt><strong>pcalendar</strong> (<em>if required by</em> <a class="reference internal" href="#frame-punits"><em>punits</em></a>)</dt>
<dd>The calendar of the partition&#8217;s data array.</dd>
<dt><strong>location</strong></dt>
<dd>An ordered list of the ranges of indices for each dimension of
the master array which describe the section of the master array
spanned by this partition. The ranges correspond to the
<a class="reference internal" href="#frame-dimensions"><em>dimensions</em></a> list.</dd>
<dt><strong>part</strong></dt>
<dd>An ordered list of indices for each dimension of the partition&#8217;s
sub-array which describes the part of the sub-array which
applies to this partition. The indices correspond to the
<a class="reference internal" href="#frame-pdimensions"><em>pdimensions</em></a> list.</dd>
</dl>
<dl class="docutils" id="frame-data">
<dt><strong>data</strong></dt>
<dd>A reference to the partition&#8217;s sub-array.</dd>
</dl>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. A conceptual framework for the in-memory storage of aggregated arrays</a><ul>
<li><a class="reference internal" href="#accounting-for-arbitrary-sub-array-properties">2.1. Accounting for arbitrary sub-array properties</a></li>
<li><a class="reference internal" href="#parameters-required-for-specifying-an-aggregated-data-array">2.2. Parameters required for specifying an aggregated data array</a><ul>
<li><a class="reference internal" href="#master-array-parameters">2.2.1. Master array parameters</a></li>
<li><a class="reference internal" href="#partition-parameters">2.2.2. Partition parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">1. Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="nca.html"
                        title="next chapter">3. The NCA convention</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/framework.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search term.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="nca.html" title="3. The NCA convention"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="1. Introduction"
             >previous</a> |</li>
  <li><a href="index.html">CFA</a>
      <select onchange="location = this.options[this.selectedIndex].value;">
  <option value="../0.4/index.html">0.4
  <option value="../0.3/index.html">0.3
  <option value="../0.2.2/index.html">0.2.2
  <option value="../0.2.1/index.html">0.2.1
  <option value="../0.2/index.html"selected>0.2
  <option value="../0.1/index.html">0.1
  </select>
  </li>

  
        <li><a href="index.html"></a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, David Hassell.
      Last updated on Feb 27, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>